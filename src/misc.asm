

%startfree(8B)
MagicPants:
{
    LDA !ram_magic_pants_enabled : BNE +
    RTL

+   LDA $0A96 : CMP #$0009 : BEQ .check
    LDA !ram_magic_pants_state : BEQ +
    LDA !ram_magic_pants_pal1 : STA $7EC188
    LDA !ram_magic_pants_pal2 : STA $7EC18A
    LDA !ram_magic_pants_pal3 : STA $7EC19E
    LDA #$0000 : STA !ram_magic_pants_state
+   RTL

  .check
    LDA $0A1C : CMP #$0009 : BEQ .flash
    CMP #$000A : BEQ .flash
    RTL

  .flash
    LDA !ram_magic_pants_state : BNE +
    LDA $7EC188 : STA !ram_magic_pants_pal1
    LDA $7EC18A : STA !ram_magic_pants_pal2
    LDA $7EC19E : STA !ram_magic_pants_pal3
    LDA !ram_magic_pants_sfx : BEQ +
    %sfxbeep()
+   LDA #$FFFF : STA $7EC19E : STA !ram_magic_pants_state
    RTL
}
%endfree(8B)


; label for HUD graphics
org $82C5DD
hudgfx_bin:


; Skips the waiting time after teleporting
org $90E877
NoLoadAnimation:
    LDA !MUSIC_TRACK
    JSL $808FC1 ; queue room music track
    BRA .skip

org $90E898
  .skip


; Critical energy alarm
org $90EA7F
    JMP CriticalEnergyAlarm
CriticalEnergyAlarm_return:

%startfree(90)
CriticalEnergyAlarm:
{
    LDA !sram_energyalarm : BNE .noBeep
    LDA !MUSIC_BANK ; overwritten code
    JMP .return

  .noBeep
    LDA !SAMUS_HP : CMP #$001F : BMI ..enable
    STZ $0A6A
    RTS

  ..enable
    LDA #$0001 : STA $0A6A
    RTS
}
%endfree(90)


%startfree(80)
transfer_cgram_long:
    LDX #$80 : STX $2100
    JSR $933A
    LDX #$0F : STX $2100
    RTL
%endfree(80)


;org $92D246
;; Repoint escape timer tiles
;EscapeTimerTiles:
;incbin ../resources/EscapeTimerTiles.bin
;
;pushpc
;org $A7B423
;    LDA.w #(EscapeTimerTiles>>8)&$FF00 : STA $00D3,Y
;    LDA.w #EscapeTimerTiles : STA $00D2,Y
;warnpc $A7B42F
;pullpc


; Rewrite load station lists so we can add our own
org $80C4B5
LoadStationLists:
    dw .mainDeck, .SRX, .TRO, .PYR, .AQA, .ARC, .NOC, .DMX
;        ___________________________________________ Room pointer
;       |       ____________________________________ Door pointer
;       |      |       _____________________________ Door BTS
;       |      |      |       ______________________ Screen X position
;       |      |      |      |       _______________ Screen Y position
;       |      |      |      |      |       ________ Samus Y offset (relative to screen top)
;       |      |      |      |      |      |       _ Samus X offset (relative to screen centre)
;       |      |      |      |      |      |      |
  .mainDeck
    dw $8000, $91E4, $0000, $0000, $0000, $00A1, $0020 ; Crew Quarters
    dw $803D, $8F80, $0000, $0000, $0000, $00A1, $FFE0 ; Central Nexus
    dw $807A, $9328, $0000, $0000, $0000, $00A1, $0000 ; Yakuza Arena
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $88BC, $92C8, $0000, $0000, $0000, $0180, $FF5A ; testing custom load station

  .SRX
    dw $8B5A, $9400, $0000, $0100, $0000, $00B0, $0000 ; Revival Room
    dw $8B5A, $9400, $0000, $0100, $0000, $00B0, $0000 ; Revival Room
    dw $8B5A, $9400, $0000, $0000, $0000, $00B0, $0010 ; Revival Room (right)
    dw $8B5A, $9400, $0000, $0200, $0000, $00B0, $FFF0 ; Revival Room (left)
    dw $8A2F, $9664, $0000, $0000, $0000, $00A1, $FFE0 ; Twin Junctions West
    dw $8A52, $95C8, $0000, $0000, $0000, $00A1, $FFE0 ; Twin Junctions East
    dw $8A90, $9850, $0000, $0000, $0000, $00A1, $0020 ; East Spike Tower
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .TRO
    dw $932D, $9D90, $0000, $0000, $0000, $00A1, $0020 ; Cloister
    dw $9350, $9A30, $0000, $0000, $0000, $00A1, $FFE0 ; Cultivation Station
    dw $9373, $9BF8, $0000, $0000, $0000, $00A1, $0000 ; Crum Ball Tower
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .PYR
    dw $9C22, $9F34, $0000, $0000, $0000, $00A1, $0020 ; Entrance Lobby
    dw $9C45, $A0B4, $0000, $0000, $0000, $00A1, $FFE0 ; Big Red
    dw $9C68, $A1C8, $0000, $0000, $0000, $00A1, $FFE0 ; Bubble Heights
    dw $9C8B, $A3CC, $0000, $0000, $0000, $00A1, $0000 ; Neo-Ridley Gauntlet Access
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .AQA
    dw $A47A, $A5B8, $0000, $0000, $0000, $00A1, $FFE0 ; Reservoir Vault
    dw $A49D, $A75C, $0000, $0000, $0000, $00A1, $0000 ; Sciser Shaft
    dw $A4C0, $A8F4, $0000, $0000, $0000, $00A1, $0000 ; Buoyant Bridge
    dw $A4E3, $AB40, $0000, $0000, $0000, $00A1, $0000 ; Neo-Draygon Access
    dw $A506, $AABC, $0000, $0000, $0000, $00A1, $0020 ; Glass Tube
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .ARC
    dw $AEB0, $AD80, $0000, $0000, $0000, $00A1, $FFE0 ; North Blue Tower
    dw $AEEE, $ACB4, $0000, $0000, $0000, $00A1, $0000 ; South Blue Tower
    dw $AF2C, $B038, $0000, $0000, $0000, $00A1, $FFE0 ; Cellar
    dw $AF4F, $B140, $0000, $0000, $0000, $00A1, $0000 ; Freezer
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .NOC
    dw $B737, $B1F4, $0000, $0000, $0000, $00A1, $0000 ; Entrance Lobby
    dw $B75A, $B3F8, $0000, $0000, $0000, $00A1, $0000 ; East Turbo Tube Access
    dw $B77D, $B6C8, $0000, $0000, $0000, $00A1, $0020 ; Warehouse
    dw $B7A0, $B50C, $0000, $0000, $0000, $00A1, $0020 ; Catacombs
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000

  .DMX
    dw $BFB0, $B7C4, $0000, $0000, $0200, $0090, $0050 ; Xenometroid Birthplace
    dw $C13C, $B854, $0004, $0000, $0000, $0090, $0050 ; Serpentine Break
    dw $C182, $B86C, $0004, $0000, $0100, $0090, $FFB0 ; Metroid Chase with Dev Exit
    dw $C1EB, $B89C, $0004, $0000, $0000, $0090, $FFB0 ; SA-X Hallway of Death
    dw $C254, $B938, $0000, $0000, $0000, $0090, $0000 ; DMX Elevator Top
    dw $C29A, $B8F0, $0000, $0100, $0000, $0090, $0050 ; Winding SA-X Chase
    dw $C326, $B92C, $0004, $0300, $0000, $00A0, $0048 ; Golden Four Containment
    dw $BF8D, $B950, $0000, $0000, $0100, $0090, $FFB0 ; Ventilation B
    dw $C0F6, $B83C, $0000, $0000, $0000, $0090, $0048 ; Omega Queen
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
    dw $0000, $0000, $0000, $0000, $0000, $0000, $0000
warnpc $80CD07


cleartable
org $80FF10
    db "This hack was hacked by InsaneFirebat without Meta's consent."

org $80FFA0
    db "Blame mm2"